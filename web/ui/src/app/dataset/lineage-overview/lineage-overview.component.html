<!--
  ~ Copyright 2017 Barclays Africa Group Limited
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div>
    <mat-grid-list cols="3">
        <mat-grid-tile colspan="2">
            <lineage-overview-graph #graph
                                    [lineage$]="lineage$"
                                    [selectedNode$]="selectedNode$"
                                    (nodeSelected)="onNodeSelected($event)"
                                    (nodeActioned)="onNodeActioned($event)">
            </lineage-overview-graph>
            <div class="graph-footer">
                <button mat-button (click)="graph.fit()" title="Fit to screen">
                    <mat-icon>filter_none</mat-icon>
                </button>
            </div>
        </mat-grid-tile>
        <mat-grid-tile>
            <div class="details-container">

                <!-- Data Source Info -->

                <div *ngIf="selectedDataSourceDescription">
                    <details-panel-header
                            [caption]="selectedDataSourceDescription.source.path"
                            faIcon="fa-file-o"
                            iconColor="steelblue">
                    </details-panel-header>
                    <hr>
                    <h5>Type: <b>{{selectedDataSourceDescription.source.type}}</b></h5>
                    <h5>Timestamp: <b>{{selectedDataSourceDescription.timestamp | date:'medium'}}</b></h5>
                    <hr>
                    <div style="text-align: center">
                        <button mat-raised-button (click)="gotoPartialLineage(selectedOperation.mainProps.id)">
                            Show detailed lineage graph
                        </button>
                    </div>
                    <hr>
                    <attribute-list [attrs]="selectedDataSourceDescription.schema.attrs"></attribute-list>
                </div>

                <!-- Composite Operation Info -->

                <div *ngIf="selectedOperation">
                    <details-panel-header
                            [caption]="selectedOperation.appName"
                            faIcon="fa-cogs"
                            iconColor="steelblue">
                    </details-panel-header>
                    <hr>
                    <h5>Application ID: <b>{{selectedOperation.appId}}</b></h5>
                    <h5>Timestamp: <b>{{selectedOperation.timestamp | date:'medium'}}</b></h5>
                    <hr>
                    <div style="text-align: center">
                        <button mat-raised-button (click)="gotoPartialLineage(selectedOperation.mainProps.id)">
                            Show detailed lineage graph
                        </button>
                    </div>
                    <hr>
                    <h3>Sources:</h3>
                    <ul>
                        <li *ngFor="let src of selectedOperation.sources">
                            <b>{{src.type}}</b> : {{src.path}}
                        </li>
                    </ul>
                </div>
            </div>
        </mat-grid-tile>
    </mat-grid-list>
</div>

<version></version>